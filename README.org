
* database

** content

CREATE TABLE content (
    `uri_content_sha1_digest` char(40) NOT NULL,
    `uri`   varchar(900) NOT NULL,
    `sha1_digest` char(40) NOT NULL,
    `created_at` int NOT NULL,
    PRIMARY KEY (`uri_content_sha1_digest`, `uri`)
);


** lookup tables & relation tables

CREATE TABLE lookup_uri (
    `id` INT PRIMARY KEY AUTO_INCREMENT,
    `uri` varchar(900) NOT NULL UNIQUE
);

CREATE TABLE lookup_collection (
    `id` INT PRIMARY KEY AUTO_INCREMENT,
    `collection` varchar(128) NOT NULL UNIQUE
);

CREATE TABLE rel_uri_collection (
    `uri_id` INT,
    `collection_id` INT,
    PRIMARY KEY (uri_id, collection_id)
);

** uri_archive

CREATE TABLE uri_archive (
    `uri`   varchar(900) NOT NULL,
    `created_at` int NOT NULL,
    `content_sha1_digest` char(40) NOT NULL,
    `header_sha1_digest` char(40) NOT NULL,
    PRIMARY KEY (`uri`, `created_at`)
);

** feed_archive

CREATE TABLE feed_archive (
    `uri`   varchar(900) NOT NULL,
    `created_at` int NOT NULL,
    `sha1_digest` char(40) NOT NULL,
    PRIMARY KEY (`uri`, `created_at`)
);

CREATE TABLE feed_entries (
    `uri`   varchar(900) NOT NULL,
    `created_at` int NOT NULL,
    `entry_json` text NOT NULL,
    PRIMARY KEY (`uri`, `created_at`)
);

** url archive

sqlite3 ~/var/Diversion/db/uri.sqlite3 <<EOF

CREATE TABLE uri_archive (
    `uri`   varchar(900) NOT NULL,
    `created_at` int NOT NULL,
    `sha1_digest` char(40) NOT NULL,
    PRIMARY KEY (`uri`, `created_at`)
);

CREATE TABLE uri_title (
    `uri`   varchar(900) NOT NULL,
    `title` varchar(1024) NOT NULL
);

CREATE TABLE uri_content (
    `uri`     varchar(900)  NOT NULL,
    `content` varchar(10240) NOT NULL
);

CREATE TABLE uri_extracted (
    `uri`       varchar(900)  NOT NULL,
    `extracted` varchar(10240) NOT NULL
);

EOF
